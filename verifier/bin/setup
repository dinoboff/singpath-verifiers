#!/usr/bin/env node
'use strict';

const verifier = require('../src/verifier');

if(require.main === module) {
  main();
}

function main() {
  /*eslint no-console: 0*/

  verifier.dockerClient().then(
    client => verifier.images.pull(client)
  ).catch(
    (err) => process.stderr.write(`Error while pulling verifier images: ${err}\n`)
  ).then(
    () => verifier.images.listMissing()
  ).then(images => {
    if (images.length > 0) {
      console.error('%d images are missing:', images.length);
      images.forEach(i => console.error(i));

      process.exit(1);
    }

    console.info('Verifier images are ready');
  });
}
